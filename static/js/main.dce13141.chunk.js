(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{12:function(e,t,i){e.exports=i(24)},18:function(e,t,i){},22:function(e,t,i){},24:function(e,t,i){"use strict";i.r(t);var n=i(1),a=i.n(n),o=i(7),r=i.n(o),s=(i(18),i(3)),u=i.n(s),d=i(4),c=i(8),h=i(10),l=i(9),m=i(5),v=i(11),f=i(2),w=i(0),p=(i(22),function(e){function t(e){var i;return Object(c.a)(this,t),(i=Object(h.a)(this,Object(l.a)(t).call(this,e))).state={showClickToStart:!0},i.buffSize=2048,i.numChannels=2,i.audioSliceSize=32,i.z_pos=-290,i.y_rot=180,i.filter1_vsh=null,i.filter1_fsh=null,i.scene=null,i.camera=null,i.renderer=null,i.canvas_area=null,i.video=null,i.createObjectURL=null,i.videoImage=null,i.videoImageContext=null,i.videoTexture=null,i.movieMaterial=null,i.audioDataQueue=[],i.audioFreqQueue=[],i.audioFreqSlice=[],i.fullscreen=!1,i.flipVideoHorizontally=i.flipVideoHorizontally.bind(Object(f.a)(Object(f.a)(i))),i.SceneUtils={createMultiMaterialObject:function(e,t){for(var i=new w.c,n=0,a=t.length;n<a;n++)i.add(new w.f(e,t[n]));return i},detach:function(e,t,i){e.applyMatrix(t.matrixWorld),t.remove(e),i.add(e)},attach:function(e,t,i){e.applyMatrix((new w.e).getInverse(i.matrixWorld)),t.remove(e),i.add(e)}},window.requestAnimationFrame||(window.requestAnimationFrame=window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(e,t){window.setTimeout(e,1e3/60)}),navigator.getUserMedia_=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia,window.createObjectURL=(window.URL||window.webkitURL||{}).createObjectURL||function(e){},window.AudioContext=window.AudioContext||window.webkitAudioContext||window.mozAudioContext||window.msAudioContext,i}return Object(v.a)(t,e),Object(m.a)(t,null,[{key:"loadShaders",value:function(){var e=Object(d.a)(u.a.mark(function e(t,i){var n,a;return u.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch(t).then(function(e){return e.text()});case 2:return n=e.sent,e.next=5,fetch(i).then(function(e){return e.text()});case 5:return a=e.sent,e.abrupt("return",{vertex:n,fragment:a});case 7:case"end":return e.stop()}},e,this)}));return function(t,i){return e.apply(this,arguments)}}()}]),Object(m.a)(t,[{key:"componentDidMount",value:function(){this.init(this.threeRootElement)}},{key:"init",value:function(){var e=Object(d.a)(u.a.mark(function e(i){var n=this;return u.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return document.addEventListener("click",function(){n.setState(function(){return{showClickToStart:!1}},function(){n.fullscreen||document.documentElement.requestFullscreen(),n.video.play()})}),document.addEventListener("keypress",function(e){13===e.keyCode&&n.fullscreen&&document.exitFullscreen()}),e.next=4,t.loadShaders("shaders/filter1.vsh","shaders/filter1.fsh");case 4:if(this.shaders=e.sent,this.scene=new w.j,this.w=640,this.h=480,this.view_angle=45,this.aspect=this.w/this.h,this.near=.1,this.far=2e4,this.camera=new w.g(this.view_angle,this.aspect,this.near,this.far),this.camera.position.set(0,0,this.z_pos),this.camera.rotation.y=this.y_rot*Math.PI/180,this.scene.add(this.camera),window.WebGLRenderingContext?this.renderer=new w.m({antialias:!0,alpha:!0}):(console.log("WebGL not supported by your browser or gpu driver. Falling back to canvas rendering."),this.renderer=new w.a),this.renderer.setSize(this.w,this.h),this.renderer.setClearColor(0,1),i.appendChild(this.renderer.domElement),this.light=new w.i(16777215),this.light.position.set(0,250,0),this.scene.add(this.light),this.video=document.createElement("video"),this.video.crossOrigin="anonymous",!navigator.getUserMedia_){e.next=29;break}navigator.getUserMedia_({video:{optional:[{minWidth:640},{minHeight:480}]},audio:!1},function(e){n.processVideo(e),n.animate(),navigator.getUserMedia_({audio:!0},function(e){n.processAudio(e)},function(e){var t="Failed to get a stream due to "+e;console.log(t)})},function(e){var t="Failed to get a stream due to "+e;console.log(t),n.video.src=""}),e.next=31;break;case 29:return console.log("Error: navigator.getUserMedia not found."),e.abrupt("return");case 31:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"processVideo",value:function(e){this.video.srcObject=e,this.video.load(),this.video.muted=!0,this.videoImage=document.createElement("canvas"),this.videoImage.width=640,this.videoImage.height=480,this.sizeMultiplier=.5,this.videoImageContext=this.videoImage.getContext("2d"),this.videoImageContext.fillStyle="#000000",this.videoImageContext.fillRect(0,0,this.videoImage.width,this.videoImage.height),this.videoTexture=new w.l(this.videoImage),this.videoTexture.minFilter=w.d,this.videoTexture.magFilter=w.d,this.movieMaterial=new w.k({uniforms:{tDiffuse:{type:"t",value:this.videoTexture},uAudioData:{type:"1fv",value:new Float32Array(this.audioSliceSize)},uAudioFreq:{type:"1fv",value:new Float32Array(this.audioSliceSize)}},vertexShader:this.shaders.vertex,fragmentShader:this.shaders.fragment,side:w.b,transparent:!0}),this.movieMaterials=[this.movieMaterial],this.movieGeometry=new w.h(Math.floor(this.videoImage.width*this.sizeMultiplier),Math.floor(this.videoImage.height*this.sizeMultiplier),4,4),this.movieScreen=new this.SceneUtils.createMultiMaterialObject(this.movieGeometry,this.movieMaterials),this.movieScreen.position.set(0,0,0),this.scene.add(this.movieScreen)}},{key:"processAudio",value:function(e){var t=this;this.audioContext=new AudioContext,this.mediaStreamSource=this.audioContext.createMediaStreamSource(e),this.recorder=this.audioContext.createScriptProcessor(this.buffSize,2,2),this.analyser=this.audioContext.createAnalyser(),this.analyser.fftSize=this.buffSize,this.recorder.onaudioprocess=function(e){for(var i in t.l=e.inputBuffer.getChannelData(0),t.r=e.inputBuffer.getChannelData(1),t.out_l=e.outputBuffer.getChannelData(0),t.out_r=e.outputBuffer.getChannelData(1),t.audioDataQueue=[],t.l)t.audioDataQueue.push(t.l[i]),t.audioDataQueue.push(t.r[i]);t.movieMaterial.uniforms.uAudioData.value=new Float32Array(t.audioDataQueue.slice(0,t.audioSliceSize)),t.audioFreqQueue=new Float32Array(t.analyser.frequencyBinCount),t.analyser.getFloatFrequencyData(t.audioFreqQueue),t.audioFreqSlice=[];for(var n=0;n<t.audioSliceSize;n++)t.audioFreqSlice.push(1-Math.abs(t.audioFreqQueue[n])/128);t.movieMaterial.uniforms.uAudioFreq.value=new Float32Array(t.audioFreqSlice),t.videoTexture&&(t.videoTexture.needsUpdate=!0)},this.mediaStreamSource.onended=function(){t.mediaStreamSource.disconnect(t.analyser),t.analyser.disconnect(t.recorder),t.recorder.disconnect(t.audioContext.destination)},this.mediaStreamSource.connect(this.analyser),this.analyser.connect(this.recorder),this.recorder.connect(this.audioContext.destination)}},{key:"animate",value:function(){window.requestAnimationFrame(this.animate.bind(this)),this.renderThree(),this.update()}},{key:"renderThree",value:function(){this.video.readyState===this.video.HAVE_ENOUGH_DATA&&(this.videoImageContext.drawImage(this.video,0,0),this.videoTexture&&(this.videoTexture.needsUpdate=!0)),this.renderer.render(this.scene,this.camera)}},{key:"update",value:function(){this.renderer.setSize(.997*window.innerWidth,.997*window.innerHeight),this.camera.aspect=window.innerWidth/window.innerHeight,this.camera.updateProjectionMatrix()}},{key:"flipVideoHorizontally",value:function(){console.log("Flipping video horizontally."),this.camera.rotation.y>=360&&(this.camera.rotation.y=0*Math.PI/180),this.camera.rotation.y+=this.y_rot*Math.PI/180,this.z_pos=-this.z_pos,this.camera.position.set(0,0,this.z_pos)}},{key:"render",value:function(){var e=this;return a.a.createElement("div",{className:"App"},this.state.showClickToStart?a.a.createElement("div",{id:"click_to_start"},"Click or tap anywhere to start the Telephone Sound audio-reactive camera filter."):null,a.a.createElement("div",{ref:function(t){return e.threeRootElement=t},onClick:this.flipVideoHorizontally}))}}]),t}(n.Component));Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));r.a.render(a.a.createElement(p,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(e){e.unregister()})}},[[12,2,1]]]);
//# sourceMappingURL=main.dce13141.chunk.js.map